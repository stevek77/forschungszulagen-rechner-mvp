<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Forschungszulagen-Rechner | Förder-Kompass</title>
  <meta name="description" content="Unverbindliche Schätzung Ihrer steuerfreien Forschungszulage nach FZulG – inkl. rückwirkender Jahre. Förder-Kompass Schnellcheck." />

  <!-- Google Font (optional) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- jsPDF (für PDF-Download / PDF-Erstellung im Flow) -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <!-- Styles -->
  <link rel="stylesheet" href="./style.css" />

  <!-- Farbanpassung (Overrides), damit es klar nach Förder-Kompass aussieht -->
  <style>
    :root{
      /* Brand / Theme (Förder-Kompass) */
      --fc-brand-900:#0b2f2a;   /* sehr dunkel (Headers) */
      --fc-brand-800:#0e3b34;   /* dunkel */
      --fc-brand-700:#0f4a41;   /* primary */
      --fc-brand-600:#116052;   /* primary hover */
      --fc-accent-500:#2bb7a5;  /* Akzent (sparsam) */
      --fc-ink-900:#0b1220;
      --fc-ink-700:#334155;
      --fc-surface:#ffffff;
      --fc-bg:#f4f7f8;          /* neutraler Hintergrund (nicht Banhoek-like) */
      --fc-border:#e6edf0;
      --fc-shadow:0 18px 50px rgba(11, 18, 32, .10);
      --fc-radius:18px;
    }

    /* Falls dein style.css CSS-Variablen nutzt, greifen diese Overrides sofort.
       Falls nicht: diese Regeln geben dem UI trotzdem ein eindeutigeres Look&Feel. */
    body{
      background: var(--fc-bg);
      color: var(--fc-ink-900);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    .badge, .pill, .tag {
      background: rgba(43,183,165,.12);
      color: var(--fc-brand-800);
      border: 1px solid rgba(43,183,165,.28);
    }
    .card, .panel, .box {
      background: var(--fc-surface);
      border: 1px solid var(--fc-border);
      border-radius: var(--fc-radius);
      box-shadow: var(--fc-shadow);
    }
    .btn-primary{
      background: linear-gradient(135deg, var(--fc-brand-700), var(--fc-brand-900));
      border: 1px solid rgba(17,96,82,.35);
    }
    .btn-primary:hover{ background: linear-gradient(135deg, var(--fc-brand-600), var(--fc-brand-900)); }
    .btn-primary:focus{ outline: 3px solid rgba(43,183,165,.25); outline-offset: 2px; }
    .btn-secondary{
      background: #fff;
      border: 1px solid var(--fc-border);
      color: var(--fc-ink-900);
    }
    .muted{ color: var(--fc-ink-700); }
    .fineprint{
      font-size: 12px;
      line-height: 1.45;
      color: #51606b;
    }
    .consent{
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px dashed var(--fc-border);
      font-size: 12px;
      line-height: 1.55;
      color: #3b4a55;
    }
    .consent a{ color: var(--fc-brand-700); text-decoration: underline; }
  </style>
</head>

<body>
  <div class="app-shell">

    <!-- Header -->
    <header class="app-header">
      <div class="app-header__left">
        <h1 class="app-title">Forschungszulagen-Rechner</h1>
        <p class="app-subtitle muted">
          Unverbindliche Schätzung Ihrer steuerfreien Forschungszulage – als erster Überblick.
          In einer Beratung finden sich häufig weitere förderfähige FuE-Anteile (z. B. sauberer Projektzuschnitt,
          Abgrenzung Stand der Technik, externe Leistungen).
        </p>
      </div>

      <div class="app-header__right">
        <span class="badge" id="badgeMvp">Förder-Kompass Schnellcheck</span>
      </div>
    </header>

    <!-- Main -->
    <main class="app-main">

      <!-- Left: Inputs -->
      <section class="panel input-panel">

        <!-- Year Tabs / Controls -->
        <div class="top-controls">
          <div class="year-tabs" role="tablist" aria-label="Projektjahre auswählen">
            <button type="button" class="tab-btn" data-year="2022">2022</button>
            <button type="button" class="tab-btn" data-year="2023">2023</button>
            <button type="button" class="tab-btn" data-year="2024">2024</button>
            <button type="button" class="tab-btn is-active" data-year="2025">2025</button>
          </div>

          <div class="year-mode">
            <label class="switch">
              <input type="checkbox" id="toggleMultiYear" checked />
              <span class="switch-ui"></span>
            </label>
            <span class="muted" style="font-size:13px;">+ Jahr</span>
          </div>
        </div>

        <div class="grid-2">
          <!-- Company size -->
          <div class="field card">
            <div class="field__label">Unternehmensgröße</div>
            <div class="segmented" role="group" aria-label="Unternehmensgröße">
              <button type="button" class="seg-btn is-active" id="btnKmu" data-size="kmu">KMU</button>
              <button type="button" class="seg-btn" id="btnLarge" data-size="gross">Großunternehmen</button>
            </div>
            <p class="fineprint muted" style="margin:10px 0 0;">
              Der Rechner nutzt je nach Jahr/Stichtag unterschiedliche Fördersätze und Deckelungen
              (MVP-nah an der Systematik).
            </p>
          </div>

          <!-- Project year selection -->
          <div class="field card">
            <div class="field__label">Projektjahr auswählen</div>
            <select id="selectYear" class="select" aria-label="Projektjahr auswählen">
              <option value="2025" selected>2025</option>
              <option value="2024">2024</option>
              <option value="2023">2023</option>
              <option value="2022">2022</option>
            </select>
            <p class="fineprint muted" style="margin:10px 0 0;">
              Rückwirkend möglich (z. B. 2022–2025). Ergebnisse werden aufsummiert.
            </p>
          </div>
        </div>

        <!-- Optional entry questions -->
        <div class="accordion card" id="accIntro">
          <button class="accordion__header" type="button" aria-expanded="false" aria-controls="accIntroBody">
            <span class="accordion__title">
              Ergänzende Fragen zum Check der Förderfähigkeit (wichtig für das Beratungsgespräch)
            </span>
            <span class="pill">optional</span>
            <span class="accordion__chev" aria-hidden="true">▾</span>
          </button>

          <div class="accordion__body" id="accIntroBody" hidden>
            <div class="grid-2" style="margin-top:12px;">
              <div class="field">
                <label class="field__label" for="qIndustry">Branche / Kurzbeschreibung</label>
                <input class="input" id="qIndustry" type="text" placeholder="z. B. Maschinenbau, Software, MedTech" />
              </div>

              <div class="field">
                <label class="field__label" for="qProjectType">Art des FuE-Vorhabens</label>
                <select id="qProjectType" class="select">
                  <option value="">Bitte auswählen</option>
                  <option value="produkt">Neuentwicklung/Produktentwicklung</option>
                  <option value="prozess">Prozess-/Verfahrensentwicklung</option>
                  <option value="software">Software/Algorithmik/Daten</option>
                  <option value="sonstiges">Sonstiges</option>
                </select>
              </div>

              <div class="field">
                <label class="field__label" for="qStartDate">Start (Monat/Jahr)</label>
                <input class="input" id="qStartDate" type="text" placeholder="MM/JJJJ" />
              </div>

              <div class="field">
                <label class="field__label" for="qEndDate">Ende / Ziel (Monat/Jahr)</label>
                <input class="input" id="qEndDate" type="text" placeholder="MM/JJJJ" />
              </div>

              <div class="field" style="grid-column:1 / -1;">
                <label class="field__label" for="qNotes">Besonderheiten / Hinweise</label>
                <textarea class="textarea" id="qNotes" rows="3" placeholder="z. B. Stand-der-Technik-Abgrenzung, Prototyp, Tests, Patente, Normen, Kooperationen..."></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- Personnel costs -->
        <div class="accordion card" id="accPersonnel">
          <button class="accordion__header" type="button" aria-expanded="true" aria-controls="accPersonnelBody">
            <span class="accordion__title">Personalkosten</span>
            <span class="pill">intern</span>
            <span class="accordion__chev" aria-hidden="true">▾</span>
          </button>

          <div class="accordion__body" id="accPersonnelBody">
            <div class="grid-2" style="margin-top:12px;">
              <div class="field">
                <label class="field__label" for="numEmployees">Anzahl Projekt-Mitarbeitende</label>
                <input class="input" id="numEmployees" type="number" min="0" step="1" value="1" />
              </div>

              <div class="field">
                <label class="field__label" for="salaryBrutto">Ø Arbeitgeber-Brutto pro Jahr (€)</label>
                <input class="input" id="salaryBrutto" type="number" min="0" step="100" value="60000" />
                <p class="fineprint muted" style="margin:8px 0 0;">
                  Optional: Wenn Sie statt Gehalt lieber Gesamt-Jahrespersonalkosten eingeben möchten, nutzen Sie unten „Gesamt Personal“.
                </p>
              </div>

              <div class="field">
                <label class="field__label" for="fueShare">FuE-Zeitanteil (%)</label>
                <input class="input" id="fueShare" type="number" min="0" max="100" step="1" value="50" />
                <p class="fineprint muted" style="margin:8px 0 0;">
                  Wie viel Prozent der Arbeitszeit im Projektjahr entfallen auf FuE?
                </p>
              </div>

              <div class="field">
                <label class="field__label" for="totalPersonnel">Alternative: Gesamt-Jahrespersonalkosten FuE (€)</label>
                <input class="input" id="totalPersonnel" type="number" min="0" step="100" placeholder="leer lassen (automatisch)" />
                <p class="fineprint muted" style="margin:8px 0 0;">
                  Wenn gefüllt, überschreibt dieser Wert die obige Berechnung.
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- External services -->
        <div class="accordion card" id="accExternal">
          <button class="accordion__header" type="button" aria-expanded="false" aria-controls="accExternalBody">
            <span class="accordion__title">Dienstleisterkosten (Auftragsforschung)</span>
            <span class="pill">extern</span>
            <span class="accordion__chev" aria-hidden="true">▾</span>
          </button>

          <div class="accordion__body" id="accExternalBody" hidden>
            <div class="grid-2" style="margin-top:12px;">
              <div class="field">
                <label class="field__label" for="externalNet">Externe FuE-Leistungen netto (€)</label>
                <input class="input" id="externalNet" type="number" min="0" step="100" value="0" />
                <p class="fineprint muted" style="margin:8px 0 0;">
                  Hinweis: Je nach Jahr gilt ein anrechenbarer Anteil (z. B. 60% bzw. 70%) – der Rechner berücksichtigt das.
                </p>
              </div>

              <div class="field">
                <label class="field__label" for="externalShare">Externe anrechenbar (%)</label>
                <input class="input" id="externalShare" type="number" min="0" max="100" step="1" placeholder="automatisch" />
                <p class="fineprint muted" style="margin:8px 0 0;">
                  Optional: manuelle Überschreibung (sonst automatisch je nach Jahr).
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Depreciation / Sachkosten -->
        <div class="accordion card" id="accAssets">
          <button class="accordion__header" type="button" aria-expanded="false" aria-controls="accAssetsBody">
            <span class="accordion__title">Sachkosten / Abschreibungen</span>
            <span class="pill">Anlagegüter</span>
            <span class="accordion__chev" aria-hidden="true">▾</span>
          </button>

          <div class="accordion__body" id="accAssetsBody" hidden>
            <div class="grid-2" style="margin-top:12px;">
              <div class="field">
                <label class="field__label" for="assetDepr">FuE-relevante Abschreibung im Jahr (€)</label>
                <input class="input" id="assetDepr" type="number" min="0" step="100" value="0" />
              </div>

              <div class="field">
                <label class="field__label" for="assetNotes">Notiz (optional)</label>
                <input class="input" id="assetNotes" type="text" placeholder="z. B. Prüfstand, Laborgerät, Server..." />
              </div>
            </div>
          </div>
        </div>

        <p class="fineprint muted" style="margin:14px 2px 0;">
          Hinweis: Unverbindliche Schätzung. Die tatsächliche Förderfähigkeit und Höhe hängt von Bescheinigungsstelle (BSFZ) und Finanzamt ab.
        </p>
      </section>

      <!-- Right: Results -->
      <aside class="panel result-panel">
        <div class="result-hero card">
          <div class="result-hero__label">IHRE POTENZIELLE FORSCHUNGSZULAGE</div>
          <div class="result-hero__value" id="resultValue">36.000&nbsp;€</div>

          <div class="result-hero__meta">
            <span class="tag" id="metaYears">4 Jahre</span>
            <span class="tag" id="metaDetail">Aktives Jahr: 2025 • P 35% • Extern 70%×35%</span>
          </div>

          <div class="result-hero__base muted">
            Bemessung: <span id="metaBase">120.000&nbsp;€</span>
          </div>
        </div>

        <div class="result-table card" aria-label="Berechnungsdetails">
          <div class="row">
            <span>Bemessungsgrundlage Personal</span>
            <strong id="basePersonnel">120.000&nbsp;€</strong>
          </div>
          <div class="row">
            <span>Bemessungsgrundlage Extern</span>
            <strong id="baseExternal">0&nbsp;€</strong>
          </div>
          <div class="row">
            <span>Bemessungsgrundlage Abschreibung</span>
            <strong id="baseAssets">0&nbsp;€</strong>
          </div>
          <div class="row row-total">
            <span>Gesamt Bemessungsgrundlage</span>
            <strong id="baseTotal">120.000&nbsp;€</strong>
          </div>
        </div>

        <!-- PDF request (Lead) -->
        <div class="card pdf-card">
          <button type="button" class="btn-primary w-full" id="btnRequestPdf">
            PDF anfordern &amp; per E-Mail erhalten
          </button>

          <!-- Hinweistext + Datenschutz -->
          <p class="fineprint muted" style="margin:10px 0 0;">
            Förder-Kompass: Die Schätzung ist ein Startpunkt – in der Zusammenarbeit werden häufig zusätzliche förderfähige FuE-Anteile sauber identifiziert.
          </p>

          <div class="consent" id="consentText">
            Ich willige ein, dass Förder-Kompass meine freiwillig angegebenen personenbezogenen Kontaktdaten verarbeitet,
            um mich im Anschluss an die Nutzung des Forschungszulagen-Rechners zum Zweck der Beratung und Information rund um die Forschungszulage nach dem FZulG zu kontaktieren.
            Die Einwilligung ist freiwillig und kann jederzeit mit Wirkung für die Zukunft widerrufen werden.
            Die Nutzung des Forschungszulagen-Rechners zur unverbindlichen Berechnung ist auch ohne Einwilligung möglich.
            Weitere Informationen zur Datenverarbeitung finden Sie in der Datenschutzerklärung auf forschungszulagenantrag.de.
          </div>
        </div>

        <!-- E-Mail Modal (kann von app.js geöffnet werden) -->
        <div class="modal" id="emailModal" aria-hidden="true" role="dialog" aria-labelledby="emailModalTitle">
          <div class="modal__backdrop" data-close="true"></div>
          <div class="modal__dialog card">
            <div class="modal__header">
              <h2 id="emailModalTitle" class="modal__title">PDF per E-Mail erhalten</h2>
              <button class="modal__close btn-secondary" type="button" data-close="true" aria-label="Schließen">✕</button>
            </div>

            <div class="modal__body">
              <div class="field">
                <label class="field__label" for="leadEmail">E-Mail</label>
                <input
                  class="input"
                  id="leadEmail"
                  type="email"
                  inputmode="email"
                  autocomplete="email"
                  placeholder="name@ihrunternehmen.de"
                />
                <p class="fineprint muted" style="margin:8px 0 0;">
                  Wir senden Ihnen das PDF mit Ihrer Berechnung an diese Adresse.
                </p>
              </div>

              <div class="field" style="margin-top:12px;">
                <label class="field__label" for="leadName">Name (optional)</label>
                <input class="input" id="leadName" type="text" autocomplete="name" placeholder="Max Mustermann" />
              </div>

              <div class="field" style="margin-top:12px;">
                <label class="field__label" for="leadCompany">Unternehmen (optional)</label>
                <input class="input" id="leadCompany" type="text" autocomplete="organization" placeholder="Muster GmbH" />
              </div>

              <div class="field" style="margin-top:12px;">
                <label class="checkbox">
                  <input type="checkbox" id="leadConsent" />
                  <span>
                    Ich habe die Datenschutzhinweise gelesen und willige in die Kontaktaufnahme ein.
                  </span>
                </label>
                <p class="fineprint muted" style="margin:8px 0 0;">
                  Ohne Einwilligung können Sie den Rechner weiterhin nutzen, jedoch kein PDF per E-Mail anfordern.
                </p>
              </div>
            </div>

            <div class="modal__footer">
              <button type="button" class="btn-secondary" data-close="true">Abbrechen</button>
              <button type="button" class="btn-primary" id="btnSendPdf">PDF anfordern</button>
            </div>
          </div>
        </div>

      </aside>
    </main>

    <footer class="app-footer muted">
      <span>© <span id="yearNow"></span> Förder-Kompass</span>
    </footer>
  </div>

  <!-- App Script -->
  <script src="./app.js"></script>
  <script>
    // Kleiner Komfort: Footer-Jahr setzen (falls app.js das nicht macht)
    (function(){
      const el = document.getElementById('yearNow');
      if(el) el.textContent = new Date().getFullYear();
    })();
  </script>
</body>
</html>
