<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Forschungszulagen-Rechner | Förder-Kompass</title>

  <!-- Google Font (optional) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- jsPDF (für PDF-Download) -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <style>
    :root{
      /* === Förder-Kompass Branding: hier anpassen === */
      --brand: #0f766e;        /* Primär (z.B. Grün/Teal) */
      --brand-2: #0b5f59;      /* dunkler */
      --bg: #fbf6f0;           /* warmes Off-White */
      --card: #ffffff;
      --text: #0f172a;
      --muted: #64748b;
      --line: #e5e7eb;
      --shadow: 0 10px 30px rgba(15,23,42,.08);
      --radius: 18px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    .wrap{
      max-width: 1140px;
      margin: 0 auto;
      padding: 34px 18px 70px;
    }

    .topbar{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:18px;
      margin-bottom: 18px;
    }

    /* Wunsch: H1 kleiner (-10%) */
    h1{
      margin:0 0 8px;
      font-size: clamp(25px, 2.9vw, 40px);
      line-height:1.08;
      letter-spacing:-0.02em;
    }
    .sub{
      margin:0;
      color: var(--muted);
      font-size: 15px;
      line-height:1.55;
      max-width: 70ch;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius: 999px;
      background: rgba(15,118,110,.10);
      color: var(--brand-2);
      border: 1px solid rgba(15,118,110,.18);
      font-weight: 600;
      font-size: 13px;
      white-space: nowrap;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.2fr .85fr;
      gap: 18px;
      margin-top: 18px;
    }

    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .badge{ display:none; }
    }

    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .card-body{ padding: 18px; }

    .toolbar{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      padding: 14px 18px;
      border-bottom: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.65));
    }

    .year-tabs{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .tab{
      border:1px solid var(--line);
      background:#fff;
      padding:8px 10px;
      border-radius: 12px;
      font-weight:600;
      cursor:pointer;
      font-size: 13px;
      color: var(--text);
    }
    .tab[aria-pressed="true"]{
      border-color: rgba(15,118,110,.35);
      background: rgba(15,118,110,.08);
      color: var(--brand-2);
    }

    /* >>> NEU: Hinweis unter den Jahreszahlen */
    .year-hint{
      margin-top: 8px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.35;
      max-width: 62ch;
    }

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 640px){
      .row{ grid-template-columns: 1fr; }
    }

    label{
      display:block;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
    }
    .hint{
      font-size: 12px;
      color: var(--muted);
      margin-top: 6px;
      line-height:1.45;
    }

    input[type="number"], input[type="email"], input[type="text"], select, textarea{
      width:100%;
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 12px 12px;
      font-size: 14px;
      outline:none;
      background:#fff;
    }
    textarea{ min-height: 92px; resize: vertical; }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(15,118,110,.45);
      box-shadow: 0 0 0 4px rgba(15,118,110,.12);
    }

    .seg{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin: 6px 0 0;
    }
    .seg button{
      border:1px solid var(--line);
      background:#fff;
      padding:10px 12px;
      border-radius: 12px;
      font-weight: 700;
      cursor:pointer;
      font-size: 13px;
      color: var(--text);
      flex: 1 1 auto;
    }
    .seg button[aria-pressed="true"]{
      border-color: rgba(15,118,110,.35);
      background: rgba(15,118,110,.08);
      color: var(--brand-2);
    }

    .radio-row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top:6px;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      border:1px solid var(--line);
      background:#fff;
      padding:10px 12px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 13px;
      cursor:pointer;
      user-select:none;
    }
    .chip input{ margin:0; }

    details{
      border: 1px solid var(--line);
      border-radius: 16px;
      overflow:hidden;
      background:#fff;
      margin-top: 12px;
    }
    summary{
      list-style:none;
      cursor:pointer;
      padding: 14px 14px;
      font-weight: 800;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    summary::-webkit-details-marker{display:none}
    .pill{
      font-size: 11px;
      font-weight: 800;
      padding: 6px 10px;
      border-radius: 999px;
      background: #f1f5f9;
      color: #0f172a;
      border:1px solid var(--line);
      white-space:nowrap;
    }
    .section{
      padding: 14px;
      border-top: 1px solid var(--line);
    }

    .result-hero{
      padding: 16px 18px;
      background: radial-gradient(90% 90% at 80% 10%, rgba(255,255,255,.15), rgba(255,255,255,0) 60%),
                  linear-gradient(135deg, #0b1220, #111827);
      color: #fff;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .kicker{
      font-size: 11px;
      letter-spacing: .12em;
      text-transform: uppercase;
      opacity: .8;
      margin:0 0 8px;
    }
    .big{
      font-size: 36px;
      font-weight: 900;
      margin:0;
      letter-spacing:-0.02em;
    }
    .meta{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 10px;
      font-size: 12px;
      opacity:.85;
    }
    .meta span{
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.10);
    }

    .result-body{ padding: 16px 18px; }

    .kv{
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 10px 12px;
      align-items:center;
      padding: 12px 0;
      border-bottom: 1px dashed var(--line);
      font-size: 14px;
    }
    .kv:last-child{ border-bottom:0; }
    .kv b{ font-weight: 800; }

    .btn{
      width:100%;
      border:0;
      border-radius: 14px;
      padding: 12px 14px;
      font-weight: 900;
      cursor:pointer;
      font-size: 14px;
    }
    .btn-primary{
      background: var(--brand);
      color:#fff;
      margin-top: 12px;
      box-shadow: 0 12px 24px rgba(15,118,110,.18);
    }
    .btn-primary:hover{ background: var(--brand-2); }
    .btn-ghost{
      background: #fff;
      border: 1px solid var(--line);
      margin-top: 10px;
    }

    .fineprint{
      margin: 10px 0 0;
      font-size: 11px;
      color: var(--muted);
      line-height:1.45;
      text-align:center;
    }

    .modal-backdrop{
      position:fixed; inset:0;
      background: rgba(2,6,23,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 50;
    }
    .modal{
      width:min(560px, 100%);
      background:#fff;
      border-radius: 18px;
      border:1px solid var(--line);
      box-shadow: 0 25px 70px rgba(2,6,23,.35);
      overflow:hidden;
    }
    .modal-head{
      padding: 14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom:1px solid var(--line);
      font-weight: 900;
    }
    .modal-body{ padding: 14px 16px; }
    .close{
      border:0;
      background: transparent;
      font-size: 20px;
      cursor:pointer;
      line-height:1;
      padding: 6px 8px;
    }
    .success{
      display:none;
      padding: 12px 12px;
      border-radius: 12px;
      background: rgba(15,118,110,.10);
      border:1px solid rgba(15,118,110,.20);
      color: var(--brand-2);
      font-weight: 700;
      margin-top: 10px;
      font-size: 13px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div>
        <h1>Forschungszulagen-Rechner</h1>
        <p class="sub">
          Unverbindliche Schätzung Ihrer steuerfreien Forschungszulage – als erster Überblick. In einer Beratung finden sich häufig weitere förderfähige FuE-Anteile (z. B. sauberer Projektzuschnitt, Abgrenzung Stand der Technik, externe Leistungen).
        </p>
      </div>
      <div class="badge">Förder-Kompass • Schnellcheck</div>
    </div>

    <div class="grid">
      <!-- LEFT: Inputs -->
      <div class="card">
        <div class="toolbar">
          <div>
            <div class="year-tabs" id="yearTabs"></div>
            <!-- NEU: Hinweis unter den Jahreszahlen -->
            <div class="year-hint">
              Hinweis: Für die Personalkosten sind Standardwerte voreingetragen. Bitte prüfen und bei Bedarf löschen oder durch Ihre Angaben ersetzen.
            </div>
          </div>
          <button class="tab" id="addYearBtn" type="button">+ Jahr</button>
        </div>

        <div class="card-body">
          <div class="row">
            <div>
              <label>Unternehmensgröße</label>
              <div class="seg">
                <button type="button" id="btnKMU" aria-pressed="true">KMU</button>
                <button type="button" id="btnGU" aria-pressed="false">Großunternehmen</button>
              </div>
              <div class="hint">Der Rechner nutzt je nach Jahr/Stichtag unterschiedliche Fördersätze und Deckelungen (MVP-nah an der Systematik).</div>
            </div>

            <div>
              <label>Projektjahr auswählen</label>
              <select id="yearSelect"></select>
              <div class="hint">Rückwirkend möglich (z. B. 2022–2025). Ergebnisse werden aufsummiert.</div>
            </div>
          </div>

          <!-- Ergänzende Fragen -->
          <details>
            <summary>
              <span>Ergänzende Fragen zum Check der Förderfähigkeit (wichtig für das Beratungsgespräch)</span>
              <span class="pill">optional</span>
            </summary>
            <div class="section">
              <div class="row">
                <div>
                  <label>Wurde Ihr Projekt nach dem 01.01.2020 gestartet?</label>
                  <div class="radio-row">
                    <label class="chip"><input type="radio" name="q_started_2020" value="Ja" checked> Ja</label>
                    <label class="chip"><input type="radio" name="q_started_2020" value="Nein"> Nein</label>
                    <label class="chip"><input type="radio" name="q_started_2020" value="Unklar"> Unklar</label>
                  </div>
                </div>
                <div>
                  <label>Ist Ihr Unternehmen in Deutschland steuerpflichtig?</label>
                  <div class="radio-row">
                    <label class="chip"><input type="radio" name="q_tax_de" value="Ja" checked> Ja</label>
                    <label class="chip"><input type="radio" name="q_tax_de" value="Nein"> Nein</label>
                    <label class="chip"><input type="radio" name="q_tax_de" value="Unklar"> Unklar</label>
                  </div>
                </div>
              </div>

              <div class="row" style="margin-top:12px;">
                <div>
                  <label>Liegt ein Projektzeitplan mit klaren Meilensteinen vor?</label>
                  <div class="radio-row">
                    <label class="chip"><input type="radio" name="q_milestones" value="Ja" checked> Ja</label>
                    <label class="chip"><input type="radio" name="q_milestones" value="Nein"> Nein</label>
                    <label class="chip"><input type="radio" name="q_milestones" value="In Arbeit"> In Arbeit</label>
                  </div>
                </div>
                <div>
                  <label>Neuer/verbesserter Software-Ansatz ggü. Stand der Technik?</label>
                  <div class="radio-row">
                    <label class="chip"><input type="radio" name="q_novelty" value="Ja" checked> Ja</label>
                    <label class="chip"><input type="radio" name="q_novelty" value="Nein"> Nein</label>
                    <label class="chip"><input type="radio" name="q_novelty" value="Teilweise"> Teilweise</label>
                  </div>
                </div>
              </div>

              <div class="row" style="margin-top:12px;">
                <div>
                  <label>Ist das technische Ergebnis offen / mit technischem Risiko verbunden?</label>
                  <div class="radio-row">
                    <label class="chip"><input type="radio" name="q_risk" value="Ja" checked> Ja</label>
                    <label class="chip"><input type="radio" name="q_risk" value="Nein"> Nein</label>
                    <label class="chip"><input type="radio" name="q_risk" value="Unklar"> Unklar</label>
                  </div>
                </div>
                <div>
                  <label>Besteht eine technische Unsicherheit, die bisher nicht eindeutig gelöst werden konnte?</label>
                  <div class="radio-row">
                    <label class="chip"><input type="radio" name="q_uncertainty" value="Ja" checked> Ja</label>
                    <label class="chip"><input type="radio" name="q_uncertainty" value="Nein"> Nein</label>
                    <label class="chip"><input type="radio" name="q_uncertainty" value="Unklar"> Unklar</label>
                  </div>
                </div>
              </div>

              <div style="margin-top:12px;">
                <label>Notizen (optional)</label>
                <textarea id="advisorNotes" placeholder="Kurznotizen für das Beratungsgespräch (z. B. Technologie, Meilensteine, externe Partner, Stand der Technik)"></textarea>
                <div class="hint">Diese Angaben werden im PDF und im Lead gespeichert (Netlify Form).</div>
              </div>
            </div>
          </details>

          <details open>
            <summary>
              <span>Personalkosten</span>
              <span class="pill">intern</span>
            </summary>
            <div class="section">
              <div class="row">
                <div>
                  <label>Anzahl Projekt-Mitarbeitende</label>
                  <input id="staffCount" type="number" min="0" step="1" value="1" />
                </div>
                <div>
                  <label>Ø Arbeitgeber-Brutto pro Jahr (€)</label>
                  <input id="salary" type="number" min="0" step="100" value="60000" />
                  <div class="hint">Optional: Wenn Sie statt Gehalt lieber Gesamt-Jahrespersonalkosten eingeben möchten, nutzen Sie unten „Gesamt Personal“.</div>
                </div>
              </div>

              <div class="row" style="margin-top:12px;">
                <div>
                  <label>FuE-Zeitanteil (%)</label>
                  <input id="fueShare" type="number" min="0" max="100" step="1" value="50" />
                  <div class="hint">Wie viel Prozent der Arbeitszeit im Projektjahr entfallen auf FuE?</div>
                </div>
                <div>
                  <label>Alternativ: Gesamt-Jahrespersonalkosten FuE (€)</label>
                  <input id="totalPersonnelOverride" type="number" min="0" step="100" placeholder="leer lassen (automatisch)" />
                  <div class="hint">Wenn gefüllt, überschreibt dieser Wert die obige Berechnung.</div>
                </div>
              </div>
            </div>
          </details>

          <details>
            <summary>
              <span>Dienstleisterkosten (Auftragsforschung)</span>
              <span class="pill">extern</span>
            </summary>
            <div class="section">
              <label>Externe FuE-Aufträge im Jahr (€)</label>
              <input id="externalCost" type="number" min="0" step="100" value="0" />
              <div class="hint">Im Rechner wird je nach Jahr/Stichtag ein förderfähiger Anteil (60%/70%) und der passende Fördersatz berücksichtigt.</div>
            </div>
          </details>

          <details>
            <summary>
              <span>Sachkosten / Abschreibungen</span>
              <span class="pill">Anlagegüter</span>
            </summary>
            <div class="section">
              <label>Jährliche Abschreibungen für FuE-relevante, bewegliche Anlagegüter (€)</label>
              <input id="deprCost" type="number" min="0" step="100" value="0" />
              <div class="hint">Im MVP nur relevant bei Aufwendungen ab 28.03.2024 (sonst wird es auf 0 gesetzt).</div>
            </div>
          </details>

          <p class="fineprint">
            Hinweis: Unverbindliche Schätzung. Die tatsächliche Förderfähigkeit und Höhe hängt von Bescheinigungsstelle (BSFZ) und Finanzamt ab.
          </p>
        </div>
      </div>

      <!-- RIGHT: Results -->
      <div class="card">
        <div class="result-hero">
          <p class="kicker">Ihre potenzielle Forschungszulage</p>
          <p class="big" id="resultAmount">0 €</p>
          <div class="meta">
            <span id="metaYears">0 Jahre</span>
            <span id="metaRate">Quote: –</span>
            <span id="metaBasis">Bemessung: 0 €</span>
          </div>
        </div>

        <div class="result-body">
          <div class="kv"><span>Bemessungsgrundlage Personal</span><b id="basisPersonnel">0 €</b></div>
          <div class="kv"><span>Bemessungsgrundlage Extern</span><b id="basisExternal">0 €</b></div>
          <div class="kv"><span>Bemessungsgrundlage Abschreibung</span><b id="basisDepr">0 €</b></div>
          <div class="kv"><span>Gesamt Bemessungsgrundlage</span><b id="basisTotal">0 €</b></div>

          <button class="btn btn-primary" id="openLeadBtn" type="button">PDF anfordern &amp; per E-Mail erhalten</button>

          <p class="fineprint">
            Förder-Kompass: Die Schätzung ist ein Startpunkt – in der Zusammenarbeit werden häufig zusätzliche förderfähige FuE-Anteile sauber identifiziert.
          </p>

          <p class="fineprint" style="text-align:left; margin-top:10px;">
            Ich willige ein, dass Förder-Kompass meine freiwillig angegebenen personenbezogenen Kontaktdaten verarbeitet, um mich im Anschluss an die Nutzung des Forschungszulagen-Rechners zum Zweck der Beratung und Information rund um die Forschungszulage nach dem FZulG zu kontaktieren.
            Die Einwilligung ist freiwillig und kann jederzeit mit Wirkung für die Zukunft widerrufen werden.
            Die Nutzung des Forschungszulagen-Rechners zur unverbindlichen Berechnung ist auch ohne Einwilligung möglich.
            Weitere Informationen zur Datenverarbeitung finden Sie in der Datenschutzerklärung auf forschungszulagenantrag.de.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Netlify Forms (unsichtbar) ===== -->
  <form name="lead-forschungszulage-rechner" method="POST" data-netlify="true" netlify-honeypot="bot-field" hidden>
    <input type="hidden" name="form-name" value="lead-forschungszulage-rechner" />
    <p>
      <label>Don’t fill this out: <input name="bot-field" /></label>
    </p>

    <!-- Lead -->
    <input type="email" name="email" />
    <input type="text" name="unternehmen" />
    <input type="text" name="name" />

    <!-- Einstiegsfragen -->
    <input type="text" name="q_started_2020" />
    <input type="text" name="q_tax_de" />
    <input type="text" name="q_milestones" />
    <input type="text" name="q_novelty" />
    <input type="text" name="q_risk" />
    <input type="text" name="q_uncertainty" />
    <input type="text" name="advisor_notes" />

    <!-- Rechnerwerte -->
    <input type="text" name="unternehmensgroesse" />
    <input type="text" name="jahre" />
    <input type="text" name="bemessung_personal" />
    <input type="text" name="bemessung_extern" />
    <input type="text" name="bemessung_abschreibung" />
    <input type="text" name="bemessung_gesamt" />
    <input type="text" name="ergebnis_forschungszulage" />
    <input type="text" name="regelhinweis" />
  </form>

  <!-- Lead Modal -->
  <div class="modal-backdrop" id="modalBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-head">
        <div id="modalTitle">PDF anfordern</div>
        <button class="close" type="button" id="closeModalBtn">×</button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div>
            <label>E-Mail*</label>
            <input id="leadEmail" type="email" placeholder="name@ihrunternehmen.de" required />
          </div>
          <div>
            <label>Name (optional)</label>
            <input id="leadName" type="text" placeholder="Max Mustermann" />
          </div>
        </div>

        <div class="row" style="margin-top:12px;">
          <div>
            <label>Unternehmen (optional)</label>
            <input id="leadCompany" type="text" placeholder="Muster GmbH" />
          </div>
          <div>
            <label>&nbsp;</label>
            <button class="btn btn-primary" type="button" id="submitLeadBtn">Absenden &amp; PDF herunterladen</button>
          </div>
        </div>

        <div class="success" id="leadSuccess">
          Danke! Ihre Anfrage wurde erfasst. Das PDF wird jetzt heruntergeladen.
        </div>

        <p class="fineprint" style="text-align:left;margin-top:10px;">
          Durch Absenden stimmen Sie zu, dass Förder-Kompass Sie zur Ergebnisbesprechung kontaktieren darf (unverbindlich).
        </p>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
